# Projects SQL Surgeries

## ğŸ“Œ DescripciÃ³n del proyecto

Este proyecto analiza el **desempeÃ±o quirÃºrgico del Sistema Nacional de Salud (SNS) de Portugal** durante el perÃ­odo **2018â€“2025**, utilizando **SQL (MySQL)** como herramienta principal de integraciÃ³n, limpieza, modelado y anÃ¡lisis de datos.

El objetivo central es evaluar si el aumento del nÃºmero de cirugÃ­as realizadas se asocia con una reducciÃ³n en los **tiempos de espera quirÃºrgicos**, especialmente en relaciÃ³n con el cumplimiento de los **Tiempos MÃ¡ximos de Respuesta Garantizados (TMRG)**.

El proyecto forma parte del **Mini Project â€“ SQL: From Data to Insight**.

---

## ğŸ¯ Objetivos

* Estandarizar y limpiar datos de intervenciones quirÃºrgicas y listas de espera.
* DiseÃ±ar un **modelo relacional (ERD)** eficiente a partir de dataframes originales.
* Integrar mÃºltiples fuentes de datos en una base de datos SQL.
* Analizar el desempeÃ±o hospitalario por centro y regiÃ³n.
* Evaluar la relaciÃ³n entre volumen de cirugÃ­as y tiempos de espera.
* Generar vistas y mÃ©tricas clave para anÃ¡lisis exploratorio y presentaciÃ³n.

---

## ğŸ“Š HipÃ³tesis

* **H0**: Si se realizan mÃ¡s cirugÃ­as, se trata a mÃ¡s pacientes y la lista y el tiempo de espera disminuyen.
* **H1**: Si se realizan mÃ¡s cirugÃ­as, se trata a mÃ¡s pacientes pero la lista y el tiempo de espera no disminuyen (o aumentan), debido a un incremento simultÃ¡neo de la demanda.

---

## ğŸ—‚ï¸ Fuentes de datos

Los datos provienen del **Portal de Transparencia del SNS de Portugal**, obtenidos vÃ­a API:

1. **Intervenciones quirÃºrgicas**

   * Dataset: `intervencoes_cirurgicas_cleaned_en`
   * InformaciÃ³n mensual por hospital sobre cirugÃ­as realizadas.

2. **Pacientes en lista de espera (SIGLIC)**

   * Dataset: `inscritos_cleaned_en`
   * InformaciÃ³n sobre pacientes inscritos y tiempos de espera.

---

## ğŸ§¹ Limpieza y estandarizaciÃ³n de datos

### NormalizaciÃ³n de centros hospitalarios

Se detectaron **duplicados e inconsistencias en los nombres de hospitales** (por ejemplo, EPE vs PPP, errores de codificaciÃ³n de caracteres).

Acciones realizadas:

* IdentificaciÃ³n de valores duplicados en `health_centre`.
* EstandarizaciÃ³n mediante `UPDATE ... CASE WHEN`.
* UnificaciÃ³n de hospitales con mÃºltiples denominaciones.

Resultado:

* **78 centros hospitalarios Ãºnicos** tras la estandarizaciÃ³n.

---

## ğŸ—ï¸ Modelo de datos

### Base de datos

```sql
CREATE DATABASE surgeries_database;
```

### Tablas principales

#### `hospitals`

Contiene informaciÃ³n estÃ¡tica de los centros de salud.

* `id_health_centre` (PK)
* `health_centre`
* `region`

#### `health_data`

Contiene informaciÃ³n mensual por hospital.

* AÃ±o y mes
* CirugÃ­as (convencionales, ambulatorias, urgentes, programadas)
* Pacientes en lista de espera
* Indicadores de tiempos de espera

RelaciÃ³n:

* `health_data.id_health_centre` â†’ `hospitals.id_health_centre`

---

## ğŸ”— IntegraciÃ³n de datos

Los datos se integran mediante:

* Join por **hospital, aÃ±o y mes** entre intervenciones y listas de espera.
* InserciÃ³n normalizada en las tablas finales.

Resultados:

* **3.098 observaciones finales** en `health_data`.

---

## ğŸ“ˆ AnÃ¡lisis exploratorio (EDA)

### DistribuciÃ³n de hospitales por regiÃ³n

* CÃ¡lculo del nÃºmero y porcentaje de hospitales por regiÃ³n.
* CreaciÃ³n de la vista:

```sql
CREATE VIEW num_health_centres AS ...
```

### Actividad quirÃºrgica

* CÃ¡lculo de:

  * Total de cirugÃ­as por hospital.
  * DistribuciÃ³n porcentual por tipo:

    * Convencional
    * Ambulatoria
    * Urgente

---

## â±ï¸ Indicadores de tiempos de espera

### Variables derivadas

Se crean nuevas mÃ©tricas clave:

* `over_max_waiting_time`
  Pacientes que superan el tiempo mÃ¡ximo garantizado.

* `pct_over_max_waiting_time`
  Porcentaje de pacientes fuera de plazo.

Estas mÃ©tricas permiten evaluar el desempeÃ±o hospitalario de forma homogÃ©nea.

---

## ğŸ‘ï¸ Vistas SQL

* `num_health_centres`
  Resumen de hospitales por regiÃ³n.

* `health_data_general`
  Vista integrada con indicadores de espera y hospitales.

Estas vistas se utilizan directamente en la presentaciÃ³n y visualizaciones.

---

## ğŸ“ AnÃ¡lisis estadÃ­stico

### CorrelaciÃ³n (Pearson)

Se calcula el **coeficiente de correlaciÃ³n de Pearson** entre:

* Variable dependiente: `% de pacientes fuera del TMRG`
* Variable independiente: `cirugÃ­as programadas`

Resultado general:

* La correlaciÃ³n es **dÃ©bil o no significativa**.
* En algunos aÃ±os, mÃ¡s cirugÃ­as se asocian incluso con mayores retrasos.

---

## ğŸ§  Principales conclusiones

* Un mayor nÃºmero de cirugÃ­as **no garantiza** una reducciÃ³n de los tiempos de espera.
* La demanda sanitaria crece de forma paralela (envejecimiento poblacional, mayor indicaciÃ³n mÃ©dica).
* Existe **alta variabilidad entre hospitales**: el desempeÃ±o individual es mÃ¡s determinante que el aÃ±o o el volumen quirÃºrgico.
* El promedio nacional de pacientes fuera del tiempo mÃ¡ximo garantizado es **â‰ˆ 23,7%**.

---

## âš ï¸ Principales desafÃ­os

* DiseÃ±o del **ERD** a partir de dataframes no relacionales.
* ImportaciÃ³n y limpieza de grandes volÃºmenes de datos en MySQL.
* Evitar el sesgo de datos acumulados anuales mediante filtrado mensual.

---

## ğŸ‘©â€ğŸ’»ğŸ‘¨â€ğŸ’» Autores

* **Borja Rubio**
* **Claudia Palladino**

---

## ğŸ› ï¸ TecnologÃ­as utilizadas

* MySQL
* SQL (DDL, DML, Views, Aggregations)
* API SNS Portugal
* AnÃ¡lisis exploratorio de datos (EDA)

---
